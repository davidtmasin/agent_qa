# -*- coding: utf-8 -*-
"""ChatBot-QA.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1TpHv8rQoqJ3Y-BIkuOPoHQZPxILnByU4
"""

# Instalar Framework ADK de agentes do Google ################################################
!pip install -q google-adk

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types  # Para criar conteÃºdos (Content e Part)

import textwrap # Para formatar melhor a saÃ­da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisiÃ§Ãµes HTTP
import warnings

warnings.filterwarnings("ignore")

# FunÃ§Ã£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um serviÃ§o de sessÃ£o em memÃ³ria
    session_service = InMemorySessionService()
    # Cria uma nova sessÃ£o (vocÃª pode personalizar os IDs conforme necessÃ¡rio)
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conteÃºdo da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execuÃ§Ã£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

# FunÃ§Ã£o auxiliar para exibir texto formatado em Markdown no Colab
def to_markdown(text):
  text = text.replace('â€¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

##########################################
# --- Agente 1: Mentor QA --- #
##########################################
def agente_mentor_qa(topico):

    mentor_qa = Agent(
        name="agente_mentor_qa",
        model="gemini-2.0-flash",
        instruction="""
        VocÃª Ã© um profissional especialista em qualidade de software e testes, com a capacidade
        de mentorar quaisquer pessoas, tanto as que atuam nessa Ã¡rea (novatos ou veteranos) quanto Ã quelas que estÃ£o em transiÃ§Ã£o.

        Seus conhecimentos sÃ£o baseados:

        - Na literatura dos autores de maior relevÃ¢ncia na Ã¡rea de Qualidade de Software e Testes como,
        Roger Pressman, Robert C. Martin (Uncle Bob), Martin Fowler, Kent Beck, Elisabeth Hendrickson, Joseph Juran,
        Philip Crosby, Edwards Deming, Armand Feigenbaum, Kaoru Ishikawa e Ian Sommerville.

        - Em conteÃºdos dos materiais do ISTQB/BSTQB (Syllabus) para os exames de certificaÃ§Ã£o como,
        CTFL, CTAL e demais certificaÃ§Ãµes relevantes para Ã¡rea de qualidade de software e testes.

        - Em documentaÃ§Ãµes oficiais de ferramentas utilizadas na realizaÃ§Ã£o dos testes, por exemplo, ferramentas de automaÃ§Ã£o web (Cypress, Selenium, Playwright, Robotframework, etc),
        ferramentas de teste de API (Postman, Insomnia, etc), ferramentas para gestÃ£o dos testes e dos bugs (Jira, TestLink, Bugzilla, Qase, etc), ferramentas de testes de performance (Jmeter, K6, Locust, etc), etc.

        Adote a ferramenta do Google (google_search) a seu favor para ter acesso Ã  informaÃ§Ãµes relevantes sobre a Ã¡rea de qualidade de software e testes para te ajudar a engrandecer
        sua base de conhecimento com informaÃ§Ãµes valiosas e Ãºteis.

        Caso o usuÃ¡rio realize perguntas quem sÃ£o totalmente fora do contexto do qual vocÃª Ã© especialista, vocÃª tem a liberdade de interromper o assunto de forma totalmente cortÃªs pois, seu foco nÃ£o Ã© esse, visto que vocÃª
        Ã© um especialista em qualidade de software e testes. Busque orientar o usuÃ¡rio sobre seu propÃ³sito para que ele evite questionar sobre questÃµes fora do seu contexto.

        """,
        description="Agente que ajuda em qualquer assunto dentro da Ã¡rea de QA",
        tools=[google_search]
    )

    entrada_do_mentor_qa = f"TÃ³pico: {topico}"

    mentoria = call_agent(mentor_qa, entrada_do_mentor_qa)
    return mentoria

#####################################################
# --- Agente 2: Especialista em Plano de Testes --- #
#####################################################
def agente_expert_plano_de_testes(contexto):
  expert_plano_de_testes = Agent(
        name="agente_expert_plano_de_testes",
        model="gemini-2.0-flash",
        instruction="""
        VocÃª Ã© um expert em QA que sabe bastante sobre como elaborar e estruturar planos de testes impecÃ¡veis para qualquer projeto de software.

        Seja didÃ¡tico na sua explicaÃ§Ã£o do plano de testes, principalmente para aqueles usuÃ¡rios que vocÃª notar que nÃ£o apresentam tanta familiaridade na
        elaboraÃ§Ã£o de um plano de testes.

        VocÃª pode fornecer um modelo exemplo de um plano de testes baseado na proposta do software que estÃ¡ sendo avaliado para testes.

        Se o usuÃ¡rio te fornecer um exemplo de plano de testes, avalie com atenÃ§Ã£o, forneÃ§a feedbacks construtivos e se for cabÃ­vel, forneÃ§a dicas para melhorias.
        """,
        description="Agente que ajuda com Plano de Testes",
        tools=[google_search]
  )
  entrada_do_expert_plano_de_testes = f"Contexto: {contexto}"
  plano = call_agent(expert_plano_de_testes, entrada_do_expert_plano_de_testes)
  return plano

print("#################################################")
print("######## ğŸš€ Iniciando o Mestre QA... ğŸš€ ########")
print("#################################################")
print("\n")
print("ğŸ¤– OlÃ¡, humano(a)! Eu meu chamo OneQway, sou seu mestre digital de QA.\n")
print("ğŸ¤– Para te guiar da melhor forma possÃ­vel, listo as seguintes opÃ§Ãµes:")
print("1ï¸âƒ£ para aprender sobre qualquer assunto dentro da Ã¡rea de QA.")
print("2ï¸âƒ£ para conversar especificamente da elaboraÃ§Ã£o de um Plano de Testes.")
print("3ï¸âƒ£ para conversar especificamente da elaboraÃ§Ã£o dos CenÃ¡rios e Casos de Teste.")
print("4ï¸âƒ£ para conversar especificamente da elaboraÃ§Ã£o do RelÃ¡torio de Bugs.")
print("5ï¸âƒ£ para conversar especificamente da elobraÃ§Ã£o do Resultado dos Testes.")

opcao_valida = False

while not opcao_valida:  # Enquanto a opÃ§Ã£o NÃƒO for vÃ¡lida...
    opcao = input("\nğŸ¤– Agora me forneÃ§a uma opÃ§Ã£o vÃ¡lida: ")

    # MENTOR QA ################################################
    if opcao == "1":
      opcao_valida = True  # Agora a opÃ§Ã£o Ã© vÃ¡lida, podemos sair do while
      print("\nğŸš€ Legal! Vamos aprender sobre QA!")
      topico = input("\nğŸ¤– O que vocÃª gostaria de aprender hoje dentro do universo QAâ“\n")

      if not topico:
          print("\nğŸ¤– Preciso que me informe o que vocÃª gostaria de aprender hojeâ—\n")
          print("#################################################")
      else:
          print(f"\nğŸ¤– Maravilha! Um momento, estou verificando minha base de conhecimento sobre: {topico}.\n")
          base_de_conhecimento = agente_mentor_qa(topico)
          print("ğŸ“ Resultado Obtido da Base de Conhecimento QA")
          display(to_markdown(base_de_conhecimento))
          print("\nğŸ¤– Caso deseje encerrar nossa conversa, basta digitar 'FIM'.\n")

          while True:
            topico = input("ğŸ¤– O que gostaria de aprender agoraâ“\n")
            if topico.lower() == 'fim':
              print('\nğŸ¤– AtÃ© a prÃ³xima, humano(a)â—')
              break
            else:
              base_de_conhecimento = agente_mentor_qa(topico)
              display(to_markdown(base_de_conhecimento))
              print("\nğŸ¤– Caso deseje encerrar nossa conversa, basta digitar 'FIM'.\n")

    # PLANO DE TESTES ################################################
    elif opcao == "2":
      print("\nğŸ“ Ã“timo! Vamos falar sobre Plano de Testes.")
      opcao_valida = True
      contexto = input("\nğŸ¤– O que vocÃª gostaria de saber sobre Plano de Testesâ“\n")

      if not contexto:
          print("\nğŸ¤– Preciso que me informe o que vocÃª gostaria de saber sobre Plano de Testesâ—\n")
          print("#################################################")

      else:
          print(f"\nğŸ¤– Maravilha! Um momento, estou analisando seu contexto: {contexto}.\n")
          contexto_plano = agente_expert_plano_de_testes(contexto)
          print("ğŸ“ Resultado Obtido ")
          display(to_markdown(contexto_plano))
          print("\nğŸ¤– Caso deseje encerrar nossa conversa, basta digitar 'FIM'.\n")

          while True:
            contexto = input("ğŸ¤– O que gostaria de saber agora sobre Plano de Testesâ“\n")
            if contexto.lower() == 'fim':
              print('\nğŸ¤– AtÃ© a prÃ³xima, humano(a)â—')
              break
            else:
              contexto_plano = agente_expert_plano_de_testes(contexto)
              display(to_markdown(contexto_plano))
              print("\nğŸ¤– Caso deseje encerrar nossa conversa, basta digitar 'FIM'.\n")




    # elif opcao == "3":
    #   print("\nâœï¸ Ã“timo! Vamos falar sobre CenÃ¡rios e Casos de Teste.")
    #   opcao_valida = True

    # elif opcao == "4":
    #   print("\nğŸ Ã“timo! Vamos falar sobre RelÃ¡torio de Bugs.")
    #   opcao_valida = True

    # elif opcao == "5":
    #   print("\nğŸ“Š Ã“timo! Vamos falar sobre Resultado dos Testes.")
    #   opcao_valida = True

    else:
      print("\nğŸ¤” Hmm, essa nÃ£o Ã© uma opÃ§Ã£o vÃ¡lida. Tente de novo!")